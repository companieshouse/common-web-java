<th:block th:with="
            cdnUrl=${@environment.getProperty('cdn.url')},
            govukFrontendRebrand=${@environment.getProperty('FEATURE_GOVUK_REBRAND') != null ?
                                  (@environment.getProperty('FEATURE_GOVUK_REBRAND') == '1' ? true : false) : false},
            govukFrontendVersion=${@environment.getProperty('GOVUK_FRONTEND_VERSION') != null ?
                                   @environment.getProperty('GOVUK_FRONTEND_VERSION') : '4.6.0'},
            govukFrontendPathname=${@environment.getProperty('GOVUK_FRONTEND_PATHNAME') != null ?
                                    @environment.getProperty('GOVUK_FRONTEND_PATHNAME') : '/rebrand'},
            cdnGOVcommonPath=${'govuk-frontend/v' + govukFrontendVersion},
            cdnGOVimages=${cdnUrl + '/images/'      + cdnGOVcommonPath + govukFrontendPathname},
            cdnGOVstatic=${cdnUrl + '/static/'      + cdnGOVcommonPath + govukFrontendPathname},
            cdnGOVjs=${cdnUrl     + '/javascripts/' + cdnGOVcommonPath + '/govuk-frontend-' + govukFrontendVersion + '.min.js'}">
<!DOCTYPE html>

<html lang="en"
      class="govuk-template app-html-class"
      th:classappend="${govukFrontendRebrand} ? 'govuk-template--rebranded' : ''"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <meta charset="UTF-8">
    <title layout:title-pattern="$CONTENT_TITLE"></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <th:block th:if="${govukFrontendRebrand}">
        <meta name="theme-color" content="#1d70b8">
        <meta property="og:image" th:content="@{${cdnGOVimages + '/govuk-opengraph-image.png'}}">
        <link rel="icon" sizes="48x48"   th:href="@{${cdnGOVimages + '/favicon.ico'}}"        type="image/x-icon">
        <link rel="icon" sizes="any"     th:href="@{${cdnGOVimages + '/favicon.svg'}}"         type="image/svg+xml">
        <link rel="mask-icon"            th:href="@{${cdnGOVimages + '/govuk-icon-mask.svg'}}" color="#1d70b8">
        <link rel="apple-touch-icon"     th:href="@{${cdnGOVimages + '/govuk-icon-180.png'}}"  type="image/png">
        <link rel="icon" sizes="192x192" th:href="@{${cdnGOVimages + '/govuk-icon-192.png'}}"  type="image/png">
        <link rel="icon" sizes="512x512" th:href="@{${cdnGOVimages + '/govuk-icon-512.png'}}"  type="image/png">
        <link rel="manifest"             th:href="@{${cdnGOVstatic + '/manifest.json'}}">
    </th:block>
    <th:block th:unless="${govukFrontendRebrand}">
        <meta name="theme-color" content="#0b0c0c">
        <meta
            property="og:image"
            th:content="@{${cdnUrl + '/images/govuk-opengraph-image.png'}}">
        <link
            rel="icon"
            th:href="@{${cdnUrl + '/images/govuk-frontend/v4.6.0/images/favicon.ico'}}"
            type="image/x-icon" />
    </th:block>

    <link
            th:href="@{${cdnUrl + '/stylesheets/chs-user-bar.css'}}"
            media="all" rel="stylesheet" type="text/css" />
    <link
            th:href="@{${cdnUrl + '/stylesheets/govuk-frontend/v' + govukFrontendVersion + '/govuk-frontend-' + govukFrontendVersion + '.min.css'}}"
            media="all" rel="stylesheet" type="text/css" />

    <link
            th:href="@{${cdnUrl + '/stylesheets/govuk-link_override.css'}}"
            media="all" rel="stylesheet" type="text/css" />
    <link
            th:href="@{${cdnUrl + '/stylesheets/extensions/languages-nav.css'}}"
            rel="stylesheet" type="text/css" />

    <script th:inline="javascript">
        window.SERVICE_NAME = [[${serviceName}]]
        window.PIWIK_URL = [[${@environment.getProperty('piwik.url')}]];
        window.PIWIK_SITE_ID = [[${@environment.getProperty('piwik.siteId')}]];
    </script>
</head>
<body class="govuk-template__body app-body-class">
    <th:block th:if="${govukFrontendRebrand}">
      <script>document.body.className += ' js-enabled' + ('noModule' in HTMLScriptElement.prototype ? ' govuk-frontend-supported' : '');</script>
    </th:block>
    <!-- templateName set by TemplateNameInterceptor and used in piwik-enable.js below for piwik/matomo event ids -->
    <div id="templateName" th:attr="data-id=${templateName},data-metadata=${metadata}" hidden></div>

    <script th:src="@{${cdnUrl + '/javascripts/app/body-js-enable.js'}}" type="text/javascript"></script>
    <script th:src="@{${cdnUrl + '/javascripts/vendor/require.js'}}" type="text/javascript"></script>
    <script th:src="@{${cdnUrl + '/javascripts/vendor/jquery-3.5.1.min.js'}}" type="text/javascript"></script>
    <script th:src="@{${cdnUrl + '/javascripts/app/piwik-enable.js'}}" type="text/javascript"></script>

    <div th:replace="~{fragments/piwikWithCookieCheck :: cookieBanner}"></div>

    <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

    <div class="entire-wrapper">
        <div th:replace="~{fragments/header :: header}"></div>
        <div class="govuk-width-container app-width-container">
            <div th:replace="~{fragments/phaseBanner :: phaseBanner}"></div>
            <div th:replace="~{fragments/back-button :: backLink}"></div>
            <div th:replace="~{fragments/userBar :: userBar}"></div>
            <div th:replace="~{fragments/adminSearch :: adminSearch}"></div>
            <div th:if="${@environment.getProperty('welshLanguage.enabled')} or ${onWelshJourney}">
                <div th:replace="~{fragments/localesBanner :: localesBanner}"></div>
            </div>
            <main id="content" role="main" class="govuk-main-wrapper app-main-class">
                <div layout:fragment="content"></div>
            </main>
        </div>
    </div>
    <div th:replace="~{fragments/footer :: footer}"></div>

    <script th:src="@{${cdnUrl + '/javascripts/app/js-enable.js'}}" type="text/javascript"></script>
    <script th:src="@{${cdnUrl + '/javascripts/vendor/selection-buttons.js'}}" type="text/javascript"></script>

    <script th:src="@{${cdnUrl + '/javascripts/app/cookie-consent/cookie-consent-1.0.0.js'}}" type="text/javascript"></script>
    <script th:src="@{${cdnUrl + '/javascripts/app/cookie-consent/matomo-only-cookie-consent.js'}}" type="text/javascript"></script>
    <th:block th:if="${govukFrontendRebrand}">
        <script type="module" th:inline="javascript">
        /*<![CDATA[*/
            import { initAll } from /*[[${cdnGOVjs}]]*/;
            initAll();
        /*]]>*/
        </script>
    </th:block>

</body>
</html>
</th:block>
